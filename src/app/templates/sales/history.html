{% extends "base.html" %} {% block title %}{{ page_title }}{% endblock %} {%
block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col">
      <h1>{{ page_title }}</h1>
    </div>
    <div class="col-auto">
      <a href="/pos" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> New Sale
      </a>
    </div>
  </div>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" action="/sales" class="row g-3">
        <div class="col-md-3">
          <label for="start_date" class="form-label">Start Date</label>
          <input
            type="date"
            class="form-control"
            id="start_date"
            name="start_date"
            value="{{ start_date }}"
          />
        </div>
        <div class="col-md-3">
          <label for="end_date" class="form-label">End Date</label>
          <input
            type="date"
            class="form-control"
            id="end_date"
            name="end_date"
            value="{{ end_date }}"
          />
        </div>
        <div class="col-md-3">
          <label for="payment_status" class="form-label">Payment Status</label>
          <select class="form-select" id="payment_status" name="payment_status">
            <option value="">All</option>
            <option
              value="pending"
              {%
              if
              payment_status=""
              ="pending"
              %}selected{%
              endif
              %}
            >
              Pending
            </option>
            <option
              value="partial"
              {%
              if
              payment_status=""
              ="partial"
              %}selected{%
              endif
              %}
            >
              Partial
            </option>
            <option
              value="paid"
              {%
              if
              payment_status=""
              ="paid"
              %}selected{%
              endif
              %}
            >
              Paid
            </option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2">
            <i class="bi bi-funnel"></i> Filter
          </button>
          <a href="/sales" class="btn btn-secondary">
            <i class="bi bi-x-circle"></i> Clear
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Sales Table -->
  <div class="card">
    <div class="card-body">
      {% if sales %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Invoice #</th>
              <th>Date</th>
              <th>Customer</th>
              <th>Total</th>
              <th>Payment</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for sale in sales %}
            <tr>
              <td>
                <a href="/sales/{{ sale.id }}">{{ sale.invoice_number }}</a>
              </td>
              <td>{{ sale.sale_date.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>
                {% if sale.customer %}
                <a href="/customers/{{ sale.customer.id }}"
                  >{{ sale.customer.name }}</a
                >
                {% else %} Walk-in {% endif %}
              </td>
              <td>${{ sale.total_amount }}</td>
              <td>
                {% if sale.payment_method %}
                <span class="badge bg-secondary"
                  >{{ sale.payment_method.title() }}</span
                >
                {% endif %}
              </td>
              <td>
                {% if sale.is_voided %}
                <span class="badge bg-danger">Voided</span>
                {% elif sale.payment_status == "paid" %}
                <span class="badge bg-success">Paid</span>
                {% elif sale.payment_status == "partial" %}
                <span class="badge bg-warning">Partial</span>
                {% else %}
                <span class="badge bg-danger">Pending</span>
                {% endif %}
              </td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <a
                    href="/sales/{{ sale.id }}"
                    class="btn btn-outline-primary"
                    title="View"
                  >
                    <i class="bi bi-eye"></i>
                  </a>
                  <a
                    href="/sales/{{ sale.id }}/receipt"
                    class="btn btn-outline-secondary"
                    title="Receipt"
                  >
                    <i class="bi bi-receipt"></i>
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if total_pages > 1 %}
      <nav aria-label="Sales pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a
              class="page-link"
              href="?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}"
              >Previous</a
            >
          </li>
          {% for p in range(1, total_pages + 1) %}
          <li class="page-item {% if p == page %}active{% endif %}">
            <a
              class="page-link"
              href="?page={{ p }}{% if search %}&search={{ search }}{% endif %}"
              >{{ p }}</a
            >
          </li>
          {% endfor %}
          <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a
              class="page-link"
              href="?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}"
              >Next</a
            >
          </li>
        </ul>
      </nav>
      {% endif %} {% else %}
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> No sales found.
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
