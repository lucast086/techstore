{% extends "base.html" %} {% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
  <!-- Print Button -->
  <div class="mb-4 flex justify-end space-x-2 print:hidden">
    <a href="/sales/{{ sale.id }}" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
      <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to Sale
    </a>
    <button onclick="window.print()" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
      <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
      </svg>
      Print Receipt
    </button>
  </div>

  <!-- Receipt -->
  <div class="bg-white rounded-lg shadow-lg p-8 print:shadow-none">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-2xl font-bold text-gray-900">{{ company.name }}</h1>
      <p class="text-gray-600 mt-1">{{ company.address }}</p>
      <p class="text-gray-600">Phone: {{ company.phone }}</p>
      <p class="text-gray-600">Email: {{ company.email }}</p>
      <p class="text-gray-600">Tax ID: {{ company.tax_id }}</p>
    </div>

    <!-- Invoice Details -->
    <div class="border-t border-b border-gray-200 py-4 mb-6">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <p class="text-sm text-gray-600">Invoice Number:</p>
          <p class="font-semibold">{{ sale.invoice_number }}</p>
        </div>
        <div class="text-right">
          <p class="text-sm text-gray-600">Date:</p>
          <p class="font-semibold">{{ sale.sale_date.strftime('%Y-%m-%d %H:%M') }}</p>
        </div>
      </div>
      {% if sale.customer %}
      <div class="mt-4">
        <p class="text-sm text-gray-600">Customer:</p>
        <p class="font-semibold">{{ sale.customer.name }}</p>
        {% if sale.customer.phone %}
        <p class="text-sm text-gray-600">Phone: {{ sale.customer.phone }}</p>
        {% endif %}
      </div>
      {% endif %}
    </div>

    <!-- Items -->
    <table class="w-full mb-6">
      <thead>
        <tr class="border-b border-gray-200">
          <th class="text-left py-2 text-sm font-semibold text-gray-900">Item</th>
          <th class="text-center py-2 text-sm font-semibold text-gray-900">Qty</th>
          <th class="text-right py-2 text-sm font-semibold text-gray-900">Price</th>
          <th class="text-right py-2 text-sm font-semibold text-gray-900">Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in sale.items %}
        <tr class="border-b border-gray-100">
          <td class="py-2">
            <div class="text-sm">
              <div class="font-medium text-gray-900">{{ item.product.name }}</div>
              <div class="text-gray-500 text-xs">SKU: {{ item.product.sku }}</div>
              {% if item.discount_percentage > 0 or item.discount_amount > 0 %}
              <div class="text-xs text-red-600">
                Discount:
                {% if item.discount_percentage > 0 %}{{ item.discount_percentage }}%{% endif %}
                {% if item.discount_amount > 0 %} ${{ item.discount_amount }}{% endif %}
              </div>
              {% endif %}
            </div>
          </td>
          <td class="text-center py-2 text-sm">{{ item.quantity }}</td>
          <td class="text-right py-2 text-sm">${{ item.unit_price }}</td>
          <td class="text-right py-2 text-sm font-medium">${{ item.total_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Totals -->
    <div class="border-t border-gray-200 pt-4">
      <div class="flex justify-between text-sm mb-2">
        <span>Subtotal:</span>
        <span>${{ sale.subtotal }}</span>
      </div>
      {% if sale.discount_amount > 0 %}
      <div class="flex justify-between text-sm mb-2 text-red-600">
        <span>Discount:</span>
        <span>-${{ sale.discount_amount }}</span>
      </div>
      {% endif %}
      <div class="flex justify-between text-sm mb-2">
        <span>Tax (16%):</span>
        <span>${{ sale.tax_amount }}</span>
      </div>
      <div class="flex justify-between text-lg font-bold border-t border-gray-200 pt-2">
        <span>Total:</span>
        <span>${{ sale.total_amount }}</span>
      </div>
    </div>

    <!-- Payment Info -->
    <div class="mt-6 pt-6 border-t border-gray-200">
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <p class="text-gray-600">Payment Method:</p>
          <p class="font-semibold">{{ sale.payment_method|capitalize }}</p>
        </div>
        <div class="text-right">
          <p class="text-gray-600">Payment Status:</p>
          <p class="font-semibold">
            {% if sale.payment_status == 'paid' %}
              <span class="text-green-600">Paid</span>
            {% elif sale.payment_status == 'partial' %}
              <span class="text-yellow-600">Partial</span>
            {% elif sale.payment_status == 'pending' %}
              <span class="text-red-600">Pending</span>
            {% else %}
              {{ sale.payment_status|capitalize }}
            {% endif %}
          </p>
        </div>
      </div>

      {% if sale.payment_status != 'paid' %}
      <div class="mt-4 p-4 bg-yellow-50 rounded-lg">
        <p class="text-sm font-semibold text-yellow-800">Amount Due: ${{ sale.amount_due }}</p>
      </div>
      {% endif %}
    </div>

    <!-- Footer -->
    <div class="mt-8 pt-6 border-t border-gray-200 text-center text-sm text-gray-600">
      <p class="font-semibold mb-2">Thank you for your business!</p>
      <p>Cashier: {{ sale.user.full_name }}</p>
      {% if sale.notes %}
      <p class="mt-2 italic">{{ sale.notes }}</p>
      {% endif %}

      {% if sale.is_voided %}
      <div class="mt-4 p-4 bg-red-100 rounded-lg">
        <p class="font-bold text-red-800">VOID - This sale has been cancelled</p>
        <p class="text-sm text-red-700">Reason: {{ sale.void_reason }}</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Print Styles -->
<style>
@media print {
  body {
    background: white;
  }
  .print\\:hidden {
    display: none !important;
  }
  .print\\:shadow-none {
    box-shadow: none !important;
  }
  .bg-gray-50 {
    background: white !important;
  }
}
</style>
{% endblock %}
