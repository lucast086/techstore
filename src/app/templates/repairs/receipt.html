<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            body {
                margin: 0;
                padding: 0;
                background: white;
            }

            .no-print {
                display: none !important;
            }

            .receipt-container {
                width: 210mm;
                height: 297mm; /* Full A4 height */
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
                page-break-after: avoid;
                page-break-inside: avoid;
            }

            .receipt-copy {
                width: 210mm;
                height: 148.5mm; /* Exactly half of A4 height */
                padding: 10mm 15mm;
                box-sizing: border-box;
                position: relative;
                overflow: hidden;
                page-break-inside: avoid;
                page-break-after: avoid;
                flex: 0 0 auto;
            }

            .receipt-copy:first-child {
                border-bottom: 2px dashed #333;
            }

            .copy-label {
                position: absolute;
                top: 8mm;
                right: 12mm;
                font-size: 11pt;
                font-weight: bold;
                color: #555;
            }

            .receipt-content {
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            /* Compact typography for print */
            h1 {
                font-size: 13pt !important;
                margin: 0 0 1mm 0 !important;
            }
            h2 {
                font-size: 11pt !important;
                margin: 0 0 1mm 0 !important;
            }
            h3 {
                font-size: 9pt !important;
                margin: 0 !important;
            }
            p {
                margin: 0 !important;
                line-height: 1.15 !important;
            }
            .text-sm {
                font-size: 7.5pt !important;
            }
            .text-xs {
                font-size: 6.5pt !important;
            }

            /* Compact spacing */
            .mb-1 { margin-bottom: 0.5mm !important; }
            .mb-2 { margin-bottom: 1mm !important; }
            .mb-3 { margin-bottom: 2mm !important; }
            .pt-1 { padding-top: 0.5mm !important; }
            .pt-2 { padding-top: 1mm !important; }

            /* Signature section at bottom */
            .signature-section {
                margin-top: auto;
                padding-top: 2mm;
            }

            /* Force single page */
            html, body {
                height: 297mm;
                width: 210mm;
                margin: 0;
                padding: 0;
            }
        }

        @media screen {
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: #f3f4f6;
                margin: 0;
                padding: 0;
            }

            .receipt-container {
                max-width: 800px;
                margin: 0 auto;
            }

            .receipt-copy {
                margin-bottom: 2rem;
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                padding: 2rem;
                background: white;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .copy-label {
                background: #f3f4f6;
                padding: 0.25rem 0.75rem;
                border-radius: 0.25rem;
                font-size: 0.875rem;
                font-weight: 600;
                color: #6b7280;
                display: inline-block;
                margin-bottom: 1rem;
            }
        }

        /* Utility classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: bold; }
        .font-semibold { font-weight: 600; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-500 { color: #6b7280; }
        .border-t { border-top: 1px solid #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-gray-400 { border-color: #9ca3af; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .pt-1 { padding-top: 0.25rem; }
        .pt-2 { padding-top: 0.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .italic { font-style: italic; }
        .space-y-0 > * + * { margin-top: 0; }
    </style>
</head>
<body>
    <div style="max-width: 800px; margin: 0 auto; padding: 1rem;">
        <!-- Print Button -->
        <div class="no-print" style="margin-bottom: 1rem; text-align: right;">
            <a href="/repairs/{{ repair.id }}" style="display: inline-block; padding: 0.5rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; color: #374151; text-decoration: none; margin-right: 0.5rem;">
                ← Volver a Reparaciones
            </a>
            <button onclick="window.print()" style="padding: 0.5rem 1rem; background: #2563eb; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                Imprimir Recibo
            </button>
        </div>

        <!-- Receipt Container -->
        <div class="receipt-container">
            {% for copy_type in ['COPY SERV. TÉCNICO', 'COPY DEL CLIENTE'] %}
            <!-- {{ copy_type }} -->
            <div class="receipt-copy">
                <span class="copy-label">{{ copy_type }}</span>
                <div class="receipt-content">

                    <!-- Header -->
                    <div class="text-center mb-2">
                        <h1 class="font-bold">{{ company.name or "TechStore" }}</h1>
                        <p class="text-xs text-gray-600">{{ company.address or "Saavedra 83 - San Basilio" }}</p>
                        <p class="text-xs text-gray-600">Phone: {{ company.phone or "(3585) 4242835" }} | Email: {{ company.email or "info@techstore.com" }}</p>
                    </div>

                    <!-- Title -->
                    <div class="text-center mb-2">
                        <h2 class="font-bold">RECIBO DE REPARACIÓN</h2>
                        <p class="font-semibold">{{ repair.repair_number }}</p>
                    </div>

                    <!-- Customer Info -->
                    <div class="grid grid-cols-2 gap-2 mb-2 text-sm border-t border-gray-300 pt-2">
                        <div>
                            <span class="text-gray-600">Cliente:</span> <span class="font-semibold">{{ repair.customer_name }}</span><br>
                            <span class="text-gray-600">Teléfono:</span> {{ repair.customer_phone }}
                        </div>
                        <div class="text-right">
                            <span class="text-gray-600">Fecha:</span> <span class="font-semibold">{{ repair.received_date.strftime('%Y-%m-%d %H:%M') }}</span>
                        </div>
                    </div>

                    <!-- Device Information -->
                    <div class="border-t border-gray-300 pt-2 mb-2">
                        <h3 class="font-semibold text-sm mb-1">INFORMACIÓN DEL DISPOSITIVO</h3>
                        <div class="grid grid-cols-2 gap-1 text-xs">
                            <div><span class="text-gray-600">Tipo:</span> {{ repair.device_type }}</div>
                            <div><span class="text-gray-600">Marca:</span> {{ repair.device_brand }}</div>
                            <div><span class="text-gray-600">Modelo:</span> {{ repair.device_model or 'N/A' }}</div>
                            <div><span class="text-gray-600">Número de Serie:</span> {{ repair.serial_number or 'N/A' }}</div>
                        </div>
                    </div>

                    <!-- Problem Description -->
                    <div class="border-t border-gray-300 pt-2 mb-2">
                        <h3 class="font-semibold text-sm mb-1">DESCRIPCIÓN DEL PROBLEMA</h3>
                        <p class="text-xs">{{ repair.problem_description }}</p>
                    </div>

                    <!-- Cost Breakdown -->
                    {% if repair.estimated_cost %}
                    <div class="border-t border-gray-300 pt-2 mb-2">
                        <div class="text-xs">
                            <div class="flex justify-between">
                                <span>Costo de Mano de Obra:</span>
                                <span>${{ "%.2f"|format(repair.labor_cost or 0) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Costo de Repuestos:</span>
                                <span>${{ "%.2f"|format(repair.parts_cost or 0) }}</span>
                            </div>
                            <div class="flex justify-between font-bold text-sm border-t pt-1 mt-1">
                                <span>Total Estimado:</span>
                                <span>${{ "%.2f"|format(repair.estimated_cost) }}</span>
                            </div>
                            <p class="text-xs text-gray-600 italic">* Solo estimado</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Estado -->
                    <div class="mb-2">
                        <p class="text-xs">
                            <span class="text-gray-600">Estado:</span>
                            <span class="font-semibold">{{ repair.status.replace('_', ' ').title() }}</span>
                        </p>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="border-t border-gray-300 pt-2 text-xs text-gray-600">
                        <p class="font-semibold">Términos:</p>
                        <ul class="text-xs space-y-0">
                            <li>• Recibo requerido para retiro</li>
                            <li>• {{ repair.warranty_days }}-días de garantía</li>
                            <li>• 30-días de almacenamiento</li>
                            <li>• No se asume responsabilidad por pérdida de datos</li>
                        </ul>
                    </div>

                    <!-- Signatures Section - Push to bottom -->
                    <div class="signature-section">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="border-t border-gray-400 pt-1">
                                    <p class="text-xs text-gray-600">Firma del Cliente</p>
                                </div>
                            </div>
                            <div>
                                <div class="border-t border-gray-400 pt-1">
                                    <p class="text-xs text-gray-600">Recibido Por: {{ current_user.full_name }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="text-center mt-2 text-xs text-gray-500">
                            <p>{{ company.name or "TechStore" }} - {{ repair.received_date.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                    </div>
                </div> <!-- End receipt-content -->
            </div> <!-- End receipt-copy -->
            {% endfor %}
        </div> <!-- End receipt-container -->
    </div>
</body>
</html>
