{% extends "base.html" %}

{% block title %}Warranty {{ warranty.warranty_number }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white shadow-sm rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-gray-800">
                    Warranty Details
                </h2>
                <a href="/warranties" class="text-blue-600 hover:text-blue-800">
                    ← Back to List
                </a>
            </div>
        </div>

        <div class="px-6 py-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Warranty Information -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Warranty Information</h3>
                    <dl class="space-y-2">
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Warranty Number</dt>
                            <dd class="text-sm text-gray-900">{{ warranty.warranty_number }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Status</dt>
                            <dd id="warranty-status">
                                {% include "warranties/partials/warranty_status.html" %}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Coverage Type</dt>
                            <dd class="text-sm text-gray-900">{{ warranty.coverage_type }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Start Date</dt>
                            <dd class="text-sm text-gray-900">{{ warranty.start_date }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Parts Warranty</dt>
                            <dd class="text-sm text-gray-900">
                                {{ warranty.parts_warranty_days }} days
                                (expires {{ warranty.parts_expiry_date }})
                                {% if warranty.is_parts_valid %}
                                <span class="text-green-600">✓ Valid</span>
                                {% else %}
                                <span class="text-red-600">✗ Expired</span>
                                {% endif %}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Labor Warranty</dt>
                            <dd class="text-sm text-gray-900">
                                {{ warranty.labor_warranty_days }} days
                                (expires {{ warranty.labor_expiry_date }})
                                {% if warranty.is_labor_valid %}
                                <span class="text-green-600">✓ Valid</span>
                                {% else %}
                                <span class="text-red-600">✗ Expired</span>
                                {% endif %}
                            </dd>
                        </div>
                    </dl>
                </div>

                <!-- Repair Information -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Repair Information</h3>
                    <dl class="space-y-2">
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Repair Number</dt>
                            <dd class="text-sm text-gray-900">
                                <a href="/repairs/{{ warranty.repair_id }}" class="text-blue-600 hover:text-blue-800">
                                    {{ warranty.repair_number }}
                                </a>
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Customer</dt>
                            <dd class="text-sm text-gray-900">{{ warranty.customer_name }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Device</dt>
                            <dd class="text-sm text-gray-900">
                                {{ warranty.device_brand }} {{ warranty.device_type }}
                                {% if warranty.device_model %}
                                ({{ warranty.device_model }})
                                {% endif %}
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>

            <!-- Void Information (if voided) -->
            {% if warranty.status == "voided" %}
            <div class="mt-6 bg-red-50 p-4 rounded-md">
                <h3 class="text-lg font-medium text-red-900 mb-2">Warranty Voided</h3>
                <dl class="space-y-2">
                    <div>
                        <dt class="text-sm font-medium text-red-700">Void Reason</dt>
                        <dd class="text-sm text-red-900">{{ warranty.void_reason }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-red-700">Voided By</dt>
                        <dd class="text-sm text-red-900">
                            {{ warranty.voided_by_name }} on {{ warranty.voided_at }}
                        </dd>
                    </div>
                </dl>
            </div>
            {% endif %}

            <!-- Terms and Exclusions -->
            {% if warranty.terms or warranty.exclusions %}
            <div class="mt-6">
                {% if warranty.terms %}
                <div class="mb-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Terms</h3>
                    <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ warranty.terms }}</p>
                </div>
                {% endif %}

                {% if warranty.exclusions %}
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Exclusions</h3>
                    <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ warranty.exclusions }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="mt-6 flex space-x-4">
                {% if warranty.status == "active" and warranty.is_valid %}
                <button hx-get="/warranties/{{ warranty.id }}/claim-form"
                        hx-target="#modal-container"
                        hx-swap="innerHTML"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    Create Claim
                </button>
                <button hx-get="/warranties/{{ warranty.id }}/void-form"
                        hx-target="#modal-container"
                        hx-swap="innerHTML"
                        class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                    Void Warranty
                </button>
                {% endif %}

                <a href="/warranties/{{ warranty.id }}/print"
                   target="_blank"
                   class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">
                    Print Warranty
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal container for HTMX -->
<div id="modal-container"></div>
{% endblock %}
